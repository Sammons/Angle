<!DOCTYPE html>
<html>
<head>
	<title>Angle</title>
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript">
	//top level things
	$(document).ready(function() {
		var socket = new WebSocket("ws://localhost:5001/");
		var beginRendering = false;
		var gameJoined = false;
		var gameDetails = {};
		var present = true;
		socket.onmessage = function(message) {
			data = JSON.parse(message.data);
			console.log(Object.keys(data));
			gameDetails[data["topic"]] = data["value"];
			console.log(gameDetails);
		};
		var sendMessage = function(message) {
			message["sent"] = Date.now();
			console.log("Sending "+message);
			var d = JSON.stringify(message);
			socket.send(d);
		};
		//igniter
		setInterval(function() {

		},1000);

		$("#submit").click(function() {
			//$("#submit").remove();

				//just once, send beginning info
				var intro = {
					"topic" : "intro",
					"name" : $("#name").val()
				}
				sendMessage(intro);
				
				var enterGame = {"topic":"connected", "value":true}
				//sendMessage(enterGame);

				$(window).keydown(function(e) {
					e.preventDefault();
					var msg = {"topic": "keydown", "value": e.which}
					sendMessage(msg);
				});
				
				setInterval(function() {
					var msg ={"topic" : "heartbeat", "value" : "alive"};
					if (present) sendMessage(msg);
				},50);
				if (gameDetails.rules.timeoutPlayers) {

					$(window).blur(function() {
						present = false;
					});

					$(window).focus(function() {
						present = true;
					});
				}
			});
		});
	</script>
	<script type="text/javascript" src="/r1"></script>
	<script type="text/javascript" src="/r2"></script>
	<script type="text/javascript" src="/r3"></script>

</head>
<body>
<header>Welcome</header>
<form>
	<input type="text" name="name" id="name" placeholder="type username here"/>
	<input type="submit" name="submit" id="submit" value="play" onclick="return false;">
</form>
<canvas id="canvas" width="500px" height="500px" style="border: 1px solid green;">
	
</canvas>
</body>
</html>